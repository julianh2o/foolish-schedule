<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar</title>
    <style>
        <%= css %>
    </style>
  </head>
  <body class="bg-gray-100">
    <% const baseHeight = 16 %>
    <% _.forEach(days, (day) => { %>
        <% const columnCount = day.columns.length %> 
        <div class="container mx-auto p-4">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-semibold text-gray-700">FoolsFest 2024: <%= day.title %></h1>
        </div>
        <div class="bg-white rounded shadow overflow-hidden">
            <div class="grid grid-cols-<%= columnCount+1 %> divide-x divide-gray-300">
                <div class="col-span-1 py-2 px-3 text-center text-xs text-gray-600"></div>
                <% _.forEach(day.columns, (col) => { %>
                    <div class="col-span-1 py-2 px-3 text-center text-sm text-gray-600 font-bold">
                        <%= col.name %>
                    </div>
                <% }) %>
                </div>
                <div class="grid grid-cols-<%= columnCount+1 %> divide-x divide-gray-300">
                    <div class="col-span-1 bg-gray-50">
                        <% _.forEach(times, (time) => { %>
                            <div class="text-sm h-<%= baseHeight %> text-gray-600 py-2 px-3 m-px border-b border-gray-300 font-bold">
                                <%= time.label %>
                            </div>
                        <% }) %>
                    </div>
                    <% _.forEach(day.columns, (col) => { %>
                        <div class="col-span-1">
                            <% _.forEach(times, (time,idx) => { %>
                                <% if (idx === times.length-1) return; %>
                                <% const items = _.filter(col.data,(item) => time.interval.contains(item.startTime)) %>
                                <% _.forEach(items, (item) => { %>
                                    <% const colorClass = typeColors[item.type]; %>
                                    <div class="<%= colorClass %> <%= item.class %> w-full h-<%= baseHeight %> text-gray-700 m-px p-2 rounded">
                                        <div>
                                            <span class="time font-bold"><%= item.startTime.toFormat("t") %></span>
                                            <span class="name"><%= item.name %></span>
                                            <span class="host italic"><%= item.host && `- ${item.host}` %></span>
                                        </div>
                                    </div>
                                <% }) %>
                                <% if (items.length === 0) { %>
                                    <div data-time="<%= time.label %>" class="w-full h-<%= baseHeight %> m-px p-2 rounded"></div>
                                <% } %>
                            <% }) %>
                        </div>
                    <% }) %>
                </div>
            </div>
        </div>
        <div class="bg-white rounded shadow overflow-hidden grid grid-cols-3">
            <% _.forEach(_.filter(classes,"description"), (item) => { %>
                <div class="col-span-1">
                    <span class="time font-bold"><%= item.startTime.toFormat("t") %></span>
                    <span class="name"><%= item.name %></span>
                    <span class="host italic"><%= item.host && `- ${item.host}` %></span>
                    <span class="description italic"><%= item.description %></span>
                </div>
            <% }) %>
        </div>
    <% }) %>
  </body>
</html>
